<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ”¥ë„ê°œê³ ë“±í•™êµ ë“œë¡  ë ˆì´ìŠ¤ğŸ”¥</title>
<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  margin: 20px;
  background: linear-gradient(135deg, #f0f4f8, #e0ebf5);
  color: #333;
}
h1 { text-align: center; font-size: 32px; font-weight: bold; color: #2c3e50; margin-bottom: 20px; }
div { text-align:center; margin:10px 0; }
input, button { padding: 8px 12px; margin: 5px; border-radius: 6px; border: 1px solid #ccc; font-size: 14px; }
button { cursor:pointer; transition: 0.2s; }
button:hover { opacity: 0.85; }
.delete-btn { background-color: #95a5a6; color:white; border:none;}
.start-btn { background-color: #2ecc71; color:white; border:none;}
table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
th { background: #3498db; color: white; padding: 10px; }
td { border: 1px solid #ddd; padding: 8px; text-align: center; }
tr:nth-child(even) { background: #f9f9f9; }
tr:hover { background: #f1f7fd; }
.record-input { width: 80px; text-align: center; }
</style>
</head>
<body>

<h1>ğŸ”¥ë„ê°œê³ ë“±í•™êµ ë“œë¡  ë ˆì´ìŠ¤ğŸ”¥</h1>

<!-- ìš´ì˜ì ë¡œê·¸ì¸ -->
<div>
  <input type="password" id="adminPassword" placeholder="ìš´ì˜ì ë¹„ë°€ë²ˆí˜¸">
  <button id="adminLoginBtn">ìš´ì˜ì ë¡œê·¸ì¸</button>
</div>

<!-- ì°¸ê°€ì ë“±ë¡ (ìš´ì˜ì ì „ìš©) -->
<div id="registrationDiv" style="display:none;">
  <input type="text" id="grade" placeholder="í•™ë…„">
  <input type="text" id="class" placeholder="ë°˜">
  <input type="text" id="number" placeholder="ë²ˆí˜¸">
  <input type="text" id="name" placeholder="ì´ë¦„(ì‹¤ëª…)">
  <button id="addParticipantBtn">ë“±ë¡</button>
</div>

<!-- ì°¸ê°€ì í…Œì´ë¸” -->
<table id="participantTable">
  <thead>
    <tr>
      <th>ë“±ìˆ˜</th>
      <th>í•™ë…„</th>
      <th>ë°˜</th>
      <th>ë²ˆí˜¸</th>
      <th>ì´ë¦„</th>
      <th>ê¸°ë¡ (mm:ss.SSS)</th>
      <th class="admin-only">ê´€ë¦¬</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<script>
let participants = JSON.parse(localStorage.getItem("participants")) || {};
let isAdmin = false;

// ì €ì¥
function saveData(){ localStorage.setItem("participants", JSON.stringify(participants)); }

// ì‹œê°„ íŒŒì‹±
function parseTime(str){
  const [m,rest]=str.split(":");
  const [s,ms]=rest.split(".");
  return parseInt(m)*60000 + parseInt(s)*1000 + parseInt(ms);
}

// ì°¸ê°€ì ë Œë”ë§
function renderParticipants(){
  const tbody = document.querySelector("#participantTable tbody");
  tbody.innerHTML = "";
  const sorted = Object.entries(participants).sort(([idA,a],[idB,b])=>{
    const minA = a.records.length ? Math.min(...a.records.map(r=>parseTime(r))) : Infinity;
    const minB = b.records.length ? Math.min(...b.records.map(r=>parseTime(r))) : Infinity;
    return minA - minB;
  });
  
  sorted.forEach(([id, p], index)=>{
    const tr = document.createElement("tr");
    const recordInputs = p.records.map((r,i)=>`<input class="record-input" type="text" value="${r}" ${isAdmin ? `onchange="updateRecord('${id}', ${i}, this.value)"` : "readonly"}>`).join("<br>");
    const rank = p.records.length ? index+1 : "-";
    tr.innerHTML = `
      <td>${rank}</td>
      <td>${p.grade}</td>
      <td>${p.classNum}</td>
      <td>${p.number}</td>
      <td>${p.name}</td>
      <td>${recordInputs}</td>
      <td class="admin-only">
        ${isAdmin ? `<button class="delete-btn" onclick="deleteParticipant('${id}')">ì‚­ì œ</button> <button class="start-btn" onclick="addRecord('${id}')">ê¸°ë¡ ì¶”ê°€</button>` : ""}
      </td>
    `;
    const top3Colors=["#FFD700","#C0C0C0","#CD7F32"];
    if(index<3 && p.records.length){ tr.style.backgroundColor=top3Colors[index]; tr.style.fontWeight="bold"; }
    tbody.appendChild(tr);
  });
  document.querySelectorAll(".admin-only").forEach(el=>{el.style.display=isAdmin?"table-cell":"none";});
  document.getElementById("registrationDiv").style.display = isAdmin ? "block" : "none";
}

// ìš´ì˜ì ë¡œê·¸ì¸
document.getElementById("adminLoginBtn").addEventListener("click",()=>{
  const password=document.getElementById("adminPassword").value;
  if(password==="robotics2025"){ isAdmin=true; renderParticipants(); alert("ìš´ì˜ì ëª¨ë“œë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤!"); }
  else{ alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."); }
});

// ì°¸ê°€ì ë“±ë¡ (ìš´ì˜ìë§Œ)
document.getElementById("addParticipantBtn").addEventListener("click",()=>{
  if(!isAdmin) { alert("ìš´ì˜ìë§Œ ì°¸ê°€ìë¥¼ ë“±ë¡í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤."); return; }
  const grade=document.getElementById("grade").value.trim();
  const classNum=document.getElementById("class").value.trim();
  const number=document.getElementById("number").value.trim();
  const name=document.getElementById("name").value.trim();
  if(!grade||!classNum||!number||!name){ alert("ëª¨ë“  ì¹¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }
  const exists=Object.values(participants).some(p=>p.grade===grade && p.classNum===classNum && p.number===number);
  if(exists){ alert("ê°™ì€ í•™ë…„/ë°˜/ë²ˆí˜¸ ì°¸ê°€ìê°€ ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤."); return; }
  const id=Date.now().toString();
  participants[id]={grade,classNum,number,name,records:[]};
  saveData(); renderParticipants(); alert(`${name} ì°¸ê°€ì ë“±ë¡ ì™„ë£Œ!`);
});

// ê¸°ë¡ ì¶”ê°€
function addRecord(id){
  if(!isAdmin) return;
  const record = prompt("ê¸°ë¡ì„ mm:ss.SSS í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”:");
  if(record) { participants[id].records.push(record); saveData(); renderParticipants(); }
}

// ê¸°ë¡ ìˆ˜ì •
function updateRecord(id, index, value){
  participants[id].records[index] = value;
  saveData();
}

// ì°¸ê°€ì ì‚­ì œ
function deleteParticipant(id){ 
  if(!isAdmin) return;
  const confirmDelete=confirm(`${participants[id].name} ì°¸ê°€ìë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);
  if(!confirmDelete) return;
  delete participants[id];
  saveData(); renderParticipants();
}

// ì´ˆê¸° ë Œë”ë§
renderParticipants();
</script>

</body>
</html>
