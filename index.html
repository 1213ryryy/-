<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ”¥ğŸšë“œë¡  ì±”í”¼ì–¸ ë ˆì´ìŠ¤ğŸšğŸ”¥</title>
<style>
body {
  font-family: "Segoe UI", Arial, sans-serif;
  margin: 20px;
  background: linear-gradient(135deg, #f0f4f8, #e0ebf5);
  color: #333;
}

h1 { text-align: center; font-size: 32px; font-weight: bold; color: #2c3e50; margin-bottom: 20px; }

div { text-align:center; margin:10px 0; }
input, button {
  padding: 8px 12px;
  margin: 5px;
  border-radius: 6px;
  border: 1px solid #ccc;
  font-size: 14px;
}

button { cursor:pointer; transition: 0.2s; }
button:hover { opacity: 0.85; }

.start-btn { background-color: #2ecc71; color:white; border:none;}
.stop-btn { background-color: #e74c3c; color:white; border:none;}
.delete-btn { background-color: #95a5a6; color:white; border:none;}

table { width: 100%; border-collapse: collapse; margin-top: 20px; background: white; border-radius: 10px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
th { background: #3498db; color: white; padding: 10px; }
td { border: 1px solid #ddd; padding: 8px; text-align: center; }
tr:nth-child(even) { background: #f9f9f9; }
tr:hover { background: #f1f7fd; }

/* ê±´ì˜í•¨ ìŠ¤íƒ€ì¼ */
#suggestionBox { display:none; border:1px solid #ccc; padding:10px; margin-top:10px; background:#f9f9f9; width:80%; margin-left:auto; margin-right:auto; }
#suggestionList { list-style:none; padding-left:0; margin-top:10px; }
#suggestionList li { margin-bottom:5px; }
#suggestionInput { width:70%; padding:5px; border-radius:5px; border:1px solid #ccc; }
#submitSuggestion { padding:5px 10px; border-radius:5px; border:none; background:#3498db; color:white; }
</style>
</head>
<body>

<h1>ğŸ”¥ğŸšë„ê°œê³ ë“±í•™êµ ë“œë¡  ì±”í”¼ì–¸ ë ˆì´ìŠ¤ğŸšğŸ”¥</h1>

<!-- ì°¸ê°€ì ë“±ë¡ -->
<div>
  <input type="text" id="grade" placeholder="í•™ë…„">
  <input type="text" id="class" placeholder="ë°˜">
  <input type="text" id="number" placeholder="ë²ˆí˜¸">
  <input type="text" id="name" placeholder="ì´ë¦„(ì‹¤ëª…ìœ¼ë¡œ ë“±ë¡)">
  <button id="addParticipantBtn">ë“±ë¡</button>
</div>

<!-- ìš´ì˜ì ë¡œê·¸ì¸ -->
<div>
  <input type="password" id="adminPassword" placeholder="ìš´ì˜ì ë¹„ë°€ë²ˆí˜¸">
  <button id="adminLoginBtn">ìš´ì˜ì ë¡œê·¸ì¸</button>
</div>

<!-- ì°¸ê°€ì í…Œì´ë¸” -->
<table id="participantTable">
  <thead>
    <tr>
      <th>í•™ë…„</th>
      <th>ë°˜</th>
      <th>ë²ˆí˜¸</th>
      <th>ì´ë¦„</th>
      <th>ê¸°ë¡</th>
      <th>ì‹¤ì‹œê°„</th>
      <th class="admin-only">ì¡°ì‘</th>
      <th class="admin-only">ê´€ë¦¬</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<!-- ê±´ì˜í•¨ ë²„íŠ¼ê³¼ ì°½ -->
<div style="text-align:center; margin-top:20px;">
  <button id="openSuggestion">ğŸ’¡ ê±´ì˜í•¨ ì—´ê¸°</button>
</div>

<div id="suggestionBox">
  <input type="text" id="suggestionInput" placeholder="ê±´ì˜ë¥¼ ì‘ì„±í•˜ì„¸ìš”...">
  <button id="submitSuggestion">ë“±ë¡</button>
  <ul id="suggestionList"></ul>
</div>

<script>
let participants = JSON.parse(localStorage.getItem("participants")) || {};
let isAdmin = false;
let timers = [];

// ì €ì¥ í•¨ìˆ˜
function saveData(){ localStorage.setItem("participants", JSON.stringify(participants)); }

// ì‹œê°„ í¬ë§·
function formatTime(ms){
  const sec=Math.floor(ms/1000);
  const m=Math.floor(sec/60);
  const s=sec%60;
  const msPart=ms%1000;
  return `${String(m).padStart(2,"0")}:${String(s).padStart(2,"0")}.${String(msPart).padStart(3,"0")}`;
}

function parseTime(str){
  const [m,rest]=str.split(":");
  const [s,ms]=rest.split(".");
  return parseInt(m)*60000 + parseInt(s)*1000 + parseInt(ms);
}

// ì°¸ê°€ì ë Œë”ë§
function renderParticipants(){
  const tbody=document.querySelector("#participantTable tbody"); 
  tbody.innerHTML="";
  const sorted=Object.entries(participants).sort(([idA,a],[idB,b])=>{
    const minA=a.records.length?Math.min(...a.records.map(r=>parseTime(r))):Infinity;
    const minB=b.records.length?Math.min(...b.records.map(r=>parseTime(r))):Infinity;
    return minA-minB;
  });
  sorted.forEach(([id,p],index)=>{
    const tr=document.createElement("tr");
    let recordDisplay=p.records.join("<br>");
    tr.innerHTML=`
      <td>${p.grade}</td>
      <td>${p.classNum}</td>
      <td>${p.number}</td>
      <td>${p.name}</td>
      <td id="record-${id}">${recordDisplay}</td>
      <td id="timer-${id}">${p.running?formatTime(Date.now()-p.startTime):""}</td>
      <td class="admin-only">
        <button class="start-btn" onclick="startTimer('${id}')">ì‹œì‘</button>
        <button class="stop-btn" onclick="stopTimer('${id}')">ì •ì§€</button>
      </td>
      <td class="admin-only">
        <button class="delete-btn" onclick="deleteParticipant('${id}')">ì‚­ì œ</button>
      </td>
    `;
    const top3Colors=["#FFD700","#C0C0C0","#CD7F32"];
    const minRecord=p.records.length?Math.min(...p.records.map(r=>parseTime(r))):null;
    if(index<3 && minRecord!==null){ tr.style.backgroundColor=top3Colors[index]; tr.style.fontWeight="bold"; }
    tbody.appendChild(tr);
  });
  document.querySelectorAll(".admin-only").forEach(el=>{el.style.display=isAdmin?"table-cell":"none";});
}

// ì°¸ê°€ì ë“±ë¡
document.getElementById("addParticipantBtn").addEventListener("click",()=>{
  const grade=document.getElementById("grade").value.trim();
  const classNum=document.getElementById("class").value.trim();
  const number=document.getElementById("number").value.trim();
  const name=document.getElementById("name").value.trim();
  if(!grade||!classNum||!number||!name){ alert("ëª¨ë“  ì¹¸ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"); return; }

  // ì¤‘ë³µ ê²€ì‚¬
  const exists=Object.values(participants).some(p=>p.grade===grade && p.classNum===classNum && p.number===number);
  if(exists){ alert("ê°™ì€ í•™ë…„/ë°˜/ë²ˆí˜¸ ì°¸ê°€ìê°€ ì´ë¯¸ ë“±ë¡ë˜ì–´ ìˆìŠµë‹ˆë‹¤."); return; }

  const id=Date.now().toString();
  participants[id]={grade,classNum,number,name,records:[],running:false};
  saveData(); renderParticipants(); alert(`${name} ì°¸ê°€ì ë“±ë¡ ì™„ë£Œ!`);
});

// ìš´ì˜ì ë¡œê·¸ì¸
document.getElementById("adminLoginBtn").addEventListener("click",()=>{
  const password=document.getElementById("adminPassword").value;
  if(password==="robotics2025"){ isAdmin=true; renderParticipants(); alert("ìš´ì˜ì ëª¨ë“œë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤!"); }
  else{ alert("ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."); }
});

// íƒ€ì´ë¨¸
function startTimer(id){ if(!isAdmin || participants[id].running) return; participants[id].running=true; participants[id].startTime=Date.now();
  timers[id]=setInterval(()=>{ document.getElementById(`timer-${id}`).textContent=formatTime(Date.now()-participants[id].startTime); },50);
  renderParticipants();
}

function stopTimer(id){ if(!isAdmin || !participants[id].running) return; participants[id].running=false;
  const elapsed=Date.now()-participants[id].startTime;
  participants[id].records.push(formatTime(elapsed));
  clearInterval(timers[id]);
  saveData(); renderParticipants();
}

// ì°¸ê°€ì ì‚­ì œ
function deleteParticipant(id){ if(!isAdmin) return;
  const confirmDelete=confirm(`${participants[id].name} ì°¸ê°€ìë¥¼ ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);
  if(!confirmDelete) return;
  delete participants[id];
  saveData(); renderParticipants();
}

// ì´ˆê¸° ë Œë”ë§
renderParticipants();

/////////////////////////
// ê±´ì˜í•¨ ê¸°ëŠ¥
/////////////////////////
let suggestions = JSON.parse(localStorage.getItem("suggestions")) || [];

document.getElementById("openSuggestion").addEventListener("click",()=>{
  const box = document.getElementById("suggestionBox");
  box.style.display = box.style.display === "none" ? "block" : "none";
});

function renderSuggestions(){
  const list = document.getElementById("suggestionList");
  list.innerHTML = "";
  suggestions.forEach((s, index)=>{
    const li = document.createElement("li");
    li.textContent = s.text;
    if(isAdmin){
      const btn = document.createElement("button");
      btn.textContent="ì‚­ì œ";
      btn.style.marginLeft="5px";
      btn.onclick = ()=>{
        suggestions.splice(index,1);
        localStorage.setItem("suggestions",JSON.stringify(suggestions));
        renderSuggestions();
      };
      li.appendChild(btn);
    }
    list.appendChild(li);
  });
}

document.getElementById("submitSuggestion").addEventListener("click",()=>{
  const input = document.getElementById("suggestionInput");
  const text = input.value.trim();
  if(!text) return;
  suggestions.push({text});
  localStorage.setItem("suggestions",JSON.stringify(suggestions));
  input.value="";
  renderSuggestions();
});

renderSuggestions();
</script>

</body>
</html>